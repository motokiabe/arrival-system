<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>送信パネル</title>
</head>
<body style="text-align:center; padding-top:100px; background:#f4f4f4;">
    <button onclick="send()" style="width:85%; padding:40px; font-size:24px; background:#007aff; color:white; border-radius:20px; font-weight:bold;">到着5分前を知らせる</button>

    <script>
    async function send() {
        // 初回のみトークンを聞かれます。メモしたghp_...を貼り付けてください。
        let token = localStorage.getItem('gh_token');
        if (!token) {
            token = prompt("新しいGitHubトークンを入力してください");
            if (token) localStorage.setItem('gh_token', token);
        }

        const username = 'motokiabe'; 
        const repo = 'arrival-system';
        
        try {
            const res = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/signal.json`, {
                headers: { 'Authorization': `token ${token}` }
            });
            const fileData = await res.json();
            
            const content = btoa(JSON.stringify({status: "start", time: new Date().getTime()}));

            const update = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/signal.json`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${token}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: "signal start",
                    content: content,
                    sha: fileData.sha
                })
            });

            if (update.ok) alert("送信成功！");
            else alert("送信失敗。トークンが間違っているか、無効です。");
        } catch (e) { alert("エラー: " + e); }
    }
    </script>
</body>
</html>

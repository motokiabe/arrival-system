<audio id="chime" src="https://raw.githubusercontent.com/motokiabe/arrival-system/main/chime.mp3" preload="auto" loop></audio>

<script>
    // ・・・中略（setupAudio関数のみ差し替え）・・・

    function setupAudio() {
        const chime = document.getElementById('chime');
        // 音量をほぼゼロにして「ずっと流しっぱなし」にする
        chime.volume = 0.001; 
        chime.play().then(() => {
            // これで音声の「専有権」をiPadから奪い取ります
            document.getElementById('start-overlay').style.display = 'none';
            setInterval(check, 2000);
        }).catch(e => alert("開始に失敗しました。もう一度タップしてください。"));
    }

    function start(sec) {
        // ・・・中略・・・
        if (sec === 300) {
            const chime = document.getElementById('chime');
            chime.pause(); // 一度止めて
            chime.currentTime = 0; // 頭に戻して
            chime.volume = 1.0; // 音量を最大にして
            chime.loop = false; // ループを解除して
            chime.play(); // 鳴らす！
            
            // 鳴り終わったら（約5秒後）また「無音ループ待機」に戻す
            setTimeout(() => {
                chime.loop = true;
                chime.volume = 0.001;
                chime.play();
            }, 6000);
        }
        // ・・・以下略・・・
    }
</script>
